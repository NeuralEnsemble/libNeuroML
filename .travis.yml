language: python

# Python 3: see: https://github.com/NeuralEnsemble/libNeuroML/issues/58
python:
  - "2.6"  # Issue with: "if sys.version_info.major == 2" in code generated by generateds.py
  - "2.7"
  - "3.5"  # Issue with: simplejson...

before_install:
    - if [ ${TRAVIS_PYTHON_VERSION:O:1} == "2" ]; then wget http://repo.continuum.io/miniconda/Miniconda2-3.19.0-Linux-x86_64.sh -O miniconda.sh; else wget http://repo.continuum.io/miniconda/Miniconda3-3.19.0-Linux-x86_64.sh -O miniconda.sh; fi
    - bash miniconda.sh -b -p /home/travis/mc
    - export PATH=/home/travis/mc/bin:$PATH

# command to install dependencies
install:
  - conda update --yes conda
  #- conda config --add channels soft-matter
  - conda create -n testenv --yes nose setuptools cython numpy pymongo numexpr python=${TRAVIS_PYTHON_VERSION}
  - source activate testenv
  - if [[ $TRAVIS_PYTHON_VERSION == "2.6" ]]; then conda install unittest2 --yes; fi
  - if [[ $TRAVIS_PYTHON_VERSION -ne "3.5" ]]; then conda install simplejson --yes ; fi
  - if [[ $TRAVIS_PYTHON_VERSION == "2.6" ]]; then conda install pytables=3.2.0 --yes ; else conda install pytables=3.3.0 --yes ; fi
  - pip install jsonpickle
  - pip install -r requirements.txt
  - pip install .

# command to run tests and examples, e.g. python setup.py test
script:  
  - cd ./neuroml/test && nosetests -vs
  - cd ../examples && python run_all.py

services: mongodb
